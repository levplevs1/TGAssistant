# AssisGov
## Описание
Данный проект представляет собой бота, который принимает показания счётчиков, обрабатывает запросы пользователей и предоставляет ответы на вопросы, связанные с показаниями.
## Установка
1. Склонируйте репозиторий:
```bash
git clone https://github.com/levplevs1/TGAssistant.git cd your-repo
```
2. Установите зависимости:
```bash
pip install -r requirements.txt
```
3. Убедитесь, что у вас установлен Python версии 3.12+.
## Настройка
1. Скопируйте файл примера конфигурации `.env.example`
2. Переименуйте файл в `.env`
   
# Инструкция по установке LM Studio, скачиванию модели и запуску сервера

## Шаг 1: Установка LM Studio
1. Перейдите на официальный сайт [LM Studio](https://lmstudio.ai).
2. Скачайте подходящую версию для вашей операционной системы:
   - Для Windows: `lmstudio-windows-x64.zip`
   - Для macOS: `lmstudio-macos-x64.dmg`
   - Для Linux: `lmstudio-linux-x64.AppImage`
3. Установите LM Studio:
   - **Windows**: Разархивируйте скачанный архив и запустите `LMStudio.exe`.
   - **macOS**: Откройте `.dmg` файл и перенесите LM Studio в папку `Программы`.
   - **Linux**: Дайте файлу права на выполнение и запустите:
     ```bash
     chmod +x lmstudio-linux-x64.AppImage
     ./lmstudio-linux-x64.AppImage
     ```

---

## Шаг 2: Скачивание нужной модели
1. Запустите LM Studio.
2. Перейдите на вкладку **Discover** (Обзор моделей).
3. Найдите модель в поиске:
```bash
bartowski/Qwen2.5-14B-Instruct-GGUF
```

## Выбор квантизации для модели

Модель **Qwen2.5 14B Instruct** доступна в различных вариантах квантизации. Для работы вашего проекта выберите подходящий вариант в зависимости от мощности вашей системы.

## Рекомендации
1. **Минимально оптимальный вариант:**
   - **Q4_K_M (8.99 GB)** — подходит для большинства современных систем с ограниченными ресурсами. Обеспечивает стабильную работу и приемлемую точность.
   
2. **Рекомендуемый вариант:**
   - **Q6_K (10.99 GB)** — требует больше ресурсов, но обеспечивает лучшую точность и производительность.

3. **Для систем с высокой производительностью:**
   Если ваша система обладает достаточными ресурсами (например, 16+ GB видеопамяти), вы можете использовать более точные модели:
   - **Q6_K_L (12.50 GB)** — для высокой точности.
   - **Q8_0 (15.75 GB)** — для максимальной точности, если объём видеопамяти позволяет.

4. **Недоступные варианты:**
   Если LM Studio сообщает, что модель "слишком велика для этой машины", попробуйте использовать варианты с меньшей квантизацией.

---

## Таблица квантизации
| Вариант     | Размер модели | Требования к ресурсам               | Описание                              |
|-------------|---------------|-------------------------------------|---------------------------------------|
| **Q4_K_M**  | 8.99 GB       | Подходит для большинства систем     | Минимально оптимальный вариант        |
| **Q6_K**    | 10.99 GB      | Средние требования                  | Рекомендуемый вариант                 |
| **Q6_K_L**  | 12.50 GB      | Высокие требования                  | Для систем с достаточным объёмом RAM  |
| **Q8_0**    | 15.75 GB      | Требует много ресурсов              | Максимальная точность                 |

---

## Как выбрать
1. Убедитесь, что ваша система соответствует требованиям выбранного варианта квантизации.
2. Если вы не уверены в возможностях вашей машины:
   - Начните с **Q4_K_M**.
   - Если система справляется, попробуйте **Q6_K** для повышения точности.

## Примечания
- Выбор квантизации влияет на точность модели и её производительность. Чем выше точность (например, Q8_0), тем больше ресурсов требуется.
- Если модель не запускается, выберите вариант с меньшей квантизацией.

Нажмите **Download** (Скачать), чтобы загрузить модель.

---

## Шаг 3: Запуск сервера
1. В LM Studio перейдите на вкладку **Server**.
2. Выберите скачанную модель из списка сверху.
3. Нажмите кнопку **Start Server**.
4. Убедитесь, что сервер запущен.
В логах появится сообщение:
* [INFO] Server started. [INFO] HTTP server listening on port 1234

Если необходимо сменить порт, в **LM Studio** во вкладке **Server** поменяйте **Server Port**, перезапустите сервер.

В файле конфигурации .env убедитесь, что указан корректный адрес:
```bash
LM_STUDIO_SERVER=http://localhost:1234/v1/chat/completions
```

# Как получить токен от Telegram-бота

Чтобы настроить Telegram-бота для вашего проекта, вам нужно получить токен доступа. Этот процесс выполняется через BotFather, официального бота Telegram для управления ботами.

---

## Шаг 1: Откройте Telegram и найдите BotFather
1. Откройте Telegram (на мобильном устройстве, ПК или через веб-версию).
2. В поиске введите `BotFather` и выберите бота с галочкой (официальный бот Telegram).

---

## Шаг 2: Создайте нового бота
1. Нажмите кнопку **Start** или отправьте команду `/start`, если бот уже был запущен ранее.
2. Отправьте команду `/newbot`, чтобы начать создание нового бота.
3. Следуйте инструкциям:
   - Введите имя вашего бота (например, `Ассистент по госуслугам`).
   - Введите уникальное имя пользователя для бота, оканчивающееся на `bot` (например, `GosAssistantBot`).

---

## Шаг 3: Получите токен для Telegram бота
После создания бота BotFather отправит вам сообщение с токеном доступа, похожим на следующий:

Use this token to access the HTTP API: 123456789:ABCDEFGHIJKLMNOPQRSTUVWXYZ12345

## Сохраните токен
1. Скопируйте токен из сообщения.
2. Сохраните токен в файле `.env`
```bash
TELEGRAMBOT_TOKEN=123456789:ABCDEFGHIJKLMNOPQRSTUVWXYZ12345
```
## Шаг 4: инструкция по настройке бэкенда и логирования

## 1. Убедитесь, что используется правильная версия Visual Studio
- Проект требует **Visual Studio 2022** или выше.
- Если Visual Studio не установлена:
  1. Скачайте и установите последнюю версию с [официального сайта Visual Studio](https://visualstudio.microsoft.com/).
  2. При установке выберите рабочую нагрузку **ASP.NET и разработка веб-приложений**.

---

## 2. Настройка проекта

# Инструкция по импорту скрипта `script_tg_bot.sql` в Microsoft SQL Server

## Шаг 1: Подготовка
1. Убедитесь, что Microsoft SQL Server установлен и запущен на вашем компьютере.
2. Откройте **SQL Server Management Studio (SSMS)**:
   - Если SSMS не установлен, скачайте и установите его с [официального сайта Microsoft](https://learn.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms).

---

## Шаг 2: Подключение к серверу
1. Запустите SSMS.
2. Подключитесь к вашему серверу:
   - В поле **Server name** укажите имя вашего сервера (например, `localhost` или `127.0.0.1`).
   - Выберите метод аутентификации:
     - **Windows Authentication**, если используется встроенная авторизация Windows.
     - **SQL Server Authentication**, если требуется ввод имени пользователя и пароля.
   - Нажмите **Connect**.

---

## Шаг 3: Импорт файла `script_tg_bot.sql`
1. Установите [script_tg_bot.sql](https://disk.yandex.ru/d/Ot87_SwlEtIVQw)
2. Перейдите в **File > Open > File** (или нажмите `Ctrl + O`).
3. Найдите и выберите файл `script_tg_bot.sql` на вашем компьютере.
4. Откроется текст скрипта в новом окне редактора в SSMS.

---

## Шаг 4: Выбор базы данных
1. В верхней панели SSMS найдите выпадающий список **Available Databases**.
2. Выберите базу данных, в которую нужно импортировать скрипт.
   - Если база данных ещё не создана, выполните следующую команду в новом окне:
     ```sql
     CREATE DATABASE TelegramBot_DataBase;
     GO
     ```
   - После этого выберите созданную базу данных.

---

## Шаг 5: Выполнение скрипта
1. Убедитесь, что выбрана нужная база данных.
2. Нажмите кнопку **Execute** (или клавишу `F5`) для выполнения скрипта.
3. Дождитесь завершения выполнения. В нижней части окна появится сообщение о статусе выполнения (например, "Query executed successfully").

### Открытие проекта
1. Откройте проект в Visual Studio.
2. Перейдите в папку `src` в проекте `TelegramBot.WebApi` и найдите файл `Program.cs`.

### Замена токена и Chat ID
1. В файле `Program.cs` найдите следующий код:
   ```csharp
   Log.Logger = new LoggerConfiguration()
       .MinimumLevel.Override("Microsoft", LogEventLevel.Information)
       .WriteTo.TeleSink(
           telegramApiKey: "*key", // Здесь токен бота
           telegramChatId: "*id" // Здесь ваш Chat ID
       )
       .CreateLogger();

## Откройте файл `appsettings.json`
1. В **Visual Studio** перейдите в проект `TelegramBot.WebApi`, находящийся в папке `src`.
2. Найдите и откройте файл `appsettings.json`.

---

## Шаг 2: Найдите строку подключения
1. В файле найдите секцию `ConnectionStrings`:
   ```json
   "ConnectionStrings": {
       "ConnectionDbString": "Data Source=ServerName;Initial Catalog=TelegramBot_DataBase;Integrated Security=True;Connect Timeout=30;"
   }
2. Замените `ServerName` на имя сервера

# Инструкция по выбору запускаемого проекта в Visual Studio

## Шаг 1: Откройте настройки запускаемого проекта
1. В Visual Studio в верхней панели рядом с кнопкой запуска (зелёная кнопка "Play") нажмите на стрелку вниз.
2. В выпадающем меню выберите пункт **Настройка начальных проектов...**.

---

## Шаг 2: Выберите запускаемый проект
1. В открывшемся окне настроек выберите опцию **Один запускаемый проект**.
2. В выпадающем списке выберите проект **TelegramBot.Domain**.

---

## Шаг 3: Сохраните изменения
1. Нажмите кнопку **ОК**, чтобы сохранить изменения.
2. Теперь проект **TelegramBot.Domain** будет запускаться при нажатии на кнопку **Run** (или `F5`).

# Инструкция: Как выбрать проект по умолчанию в консоли диспетчера пакетов и выполнить команду

## Шаг 1: Откройте консоль диспетчера пакетов
1. В Visual Studio перейдите в меню **Инструменты** → **Диспетчер пакетов NuGet** → **Консоль диспетчера пакетов**.
2. Консоль откроется в нижней части IDE.

---

## Шаг 2: Выберите проект по умолчанию
1. В правой части консоли диспетчера пакетов найдите выпадающий список с надписью **Проект по умолчанию**.
2. Нажмите на выпадающий список и выберите **TelegramBot.WebApi**).

---

## Шаг 3: Выполните команду
1. После выбора проекта выполните команду в консоли. Например, для создания миграции:
   ```bash
   Add-Migration Name
## Шаг 4: Запустите базу данных
1. После команды запустите проект в Visual Studio
   
## Шаг 5: Сохраните адрес базы данных
1. После запуска вас перенаправит на страницу Swagger, скопируйте ссылку до /index.html
2. Скопированую ссылку вставьте в `.env`
```bash
DATABASE_URL=https://localhost:7271
```


# Запуск
# Инструкция по запуску Telegram-бота

Для успешного запуска Telegram-бота выполните следующие шаги.

---

## 1. Убедитесь, что виртуальное окружение активировано
Виртуальное окружение должно быть активировано для использования зависимостей проекта. Чтобы проверить активацию:

- В командной строке должно отображаться что-то вроде:

(.venv) C:\Projects\Github\TGAssistant\TelegramBot

Если окружение не активировано:
- Для Windows выполните:
  ```bash
  .venv\Scripts\activate
  ```
- Для Linux/MacOS выполните:
  ```bash
  source .venv/bin/activate
  ```

---

## 2. Перейдите в корневую директорию проекта
В командной строке перейдите в папку с проектом:
```bash
cd C:\Projects\Github\TGAssistant\TelegramBot
```

## 3. Запустите проект
```bash
python -m app.bot.main
```

Если бот запущен успешно, вы увидите сообщение в терминале:

`The bot has been successfully launched`













# Автор
Автор: Cognitex
